<!doctype html>
<html>
	<head>
		<title>Project | Mohammad Faisal</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="Project details - Mohammad Faisal">

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500;700&display=swap" rel="stylesheet">

		<style>
:root {
	--color1: #5fffff;
	--color2: #ff87af;
	--color3: #87ff87;
	--color4: #666;
	--color5: #ffd7af;
}

* {
	margin: 0;
	padding: 0;
}

body {
	background-color: #000;
	color: var(--color5);
	font-size: 13px;
}

body, code {
	font-family: "Fira Mono", monospace;
	font-weight: 400;
	font-style: normal;
}

b, strong, h1, h2, h3, h4, h5, h6 {
	font-weight: 900;
}

#container {
	position: relative;
	margin-right: auto;
	margin-left: auto;
	margin-top: 10px;
	max-width: 800px;
	padding: 0 6px;
}

a, a:visited {
	color: var(--color1);
	text-decoration: none;
}

.title {
	color: var(--color3);
}

.content {
	max-width: 620px;
	line-height: 1.6;
	margin-top: 10px;
}

.hidden {
	display: none;
}

.shadow {
	border: 1px solid #87ff8755;
	box-shadow: 0 0 200px #87ff8734;
}

#top-nav {
	text-align: left;
	border-bottom: 1px solid #87ff8755;
	margin-bottom: 21px;
}

#top-nav > ul {
	list-style: none;
	overflow: hidden;
}

#top-nav > ul > li {
	float: left;
}

#top-nav > ul > li.right {
	float: right;
}

#top-nav > ul > li > a {
	display: block;
	text-align: center;
	color: var(--color5);
	padding: 14px 13px;
	text-decoration: none;
}

#top-nav > ul > li a:hover {
	background-color: #333;
}

#top-nav > ul > li .active {
	color: var(--color3);
}

.terminal-section {
	margin: 20px 0;
	border: 1px solid #333;
	padding: 12px;
	background: #0b0b0b;
}

.terminal-section-title {
	color: var(--color3);
	margin-bottom: 10px;
	padding-bottom: 6px;
	border-bottom: 1px solid #333;
}

.badges {
	display: flex;
	flex-wrap: wrap;
	gap: 8px;
	margin: 12px 0;
}

.badge {
	padding: 2px 8px;
	border: 1px solid var(--color1);
	border-radius: 4px;
	font-size: 11px;
}

.project-links {
	margin-top: 10px;
}

.project-links a {
	margin-right: 10px;
}

.terminal-block {
	background: #111;
	border: 1px solid #333;
	padding: 12px;
	white-space: pre-wrap;
	line-height: 1.6;
	color: var(--color5);
}

.error {
	color: var(--color2);
}

.footer {
	text-align: center;
	font-size: 12px;
	margin-top: 10px;
	padding-top: 0;
}

@media (max-width: 650px) {
	#top-nav > ul > li {
		float: none;
	}

	#top-nav > ul > li.right {
		float: none;
	}
}
		</style>
	</head>
	<body>
		<div id="container">
			<div id="top-nav">
				<ul>
					<li><a href="/">home</a></li>
					<li><a href="/myprojects" class="active">projects</a></li>
					<li><a href="/resources">resources</a></li>
					<li class="right"><a href="/">cli</a></li>
				</ul>
			</div>

			<div>
				<h1 class="title">&gt; project</h1>
				<p class="content">Single project detail view.</p>
			</div>

			<div class="terminal-section shadow">
				<div class="terminal-section-title" id="project-title">loading...</div>
				<p class="content" id="project-description"></p>
				<div id="project-badges" class="badges"></div>
				<div id="project-links" class="project-links"></div>
				<div id="project-content-block" class="hidden">
					<div class="terminal-section-title">Notes</div>
					<pre class="terminal-block" id="project-content"></pre>
				</div>
				<p class="content"><a href="/myprojects">Back to projects</a></p>
			</div>

			<pre class="footer"><code>
source: <a href="https://github.com/mohammadzfaisal/myterminalcv">github.com/mohammadzfaisal/myterminalcv</a>
&copy; mohammad faisal - mfa.sh <script>document.write(new Date().getFullYear())</script>
			</code></pre>
		</div>

		<script>
function getProjectId() {
	const params = new URLSearchParams(window.location.search);
	const queryId = params.get('id');
	if (queryId) {
		return queryId;
	}

	const parts = window.location.pathname.split('/').filter(Boolean);
	if (parts.length >= 2 && parts[0] === 'project') {
		return parts[1];
	}

	return null;
}

function setError(message) {
	const title = document.getElementById('project-title');
	const description = document.getElementById('project-description');
	title.textContent = '> project not found';
	description.textContent = message;
	description.classList.add('error');
	document.getElementById('project-badges').innerHTML = '';
	document.getElementById('project-links').innerHTML = '';
	const contentBlock = document.getElementById('project-content-block');
	contentBlock.classList.add('hidden');
}

function renderProject(project) {
	const title = document.getElementById('project-title');
	const description = document.getElementById('project-description');
	const badges = document.getElementById('project-badges');
	const links = document.getElementById('project-links');

	title.textContent = `> ${project.title}`;
	description.textContent = project.description || 'No description available.';

	badges.innerHTML = '';
	if (Array.isArray(project.badges)) {
		project.badges.forEach((badge) => {
			const el = document.createElement('span');
			el.className = 'badge';
			el.textContent = badge.name;
			if (badge.color) {
				el.style.borderColor = badge.color;
				el.style.color = badge.color;
			}
			badges.appendChild(el);
		});
	}

	links.innerHTML = '';
	if (project.link) {
		const openLink = document.createElement('a');
		openLink.href = project.link;
		openLink.textContent = 'Open project';
		if (project.link.startsWith('http')) {
			openLink.target = '_blank';
			openLink.rel = 'noopener';
		}
		links.appendChild(openLink);
	}
}

const projectId = getProjectId();
if (!projectId) {
	setError('Missing project id. Try /project?id=terraform-30 or /project/terraform-30.');
} else {
	fetch('/data.json')
		.then((response) => {
			if (!response.ok) {
				throw new Error('Could not find data.json');
			}
			return response.json();
		})
		.then((data) => {
			const project = data.projects.find((item) => item.id === projectId);
			if (!project) {
				setError('Project not found.');
				return;
			}

			renderProject(project);

			fetch(`/content/projects/${projectId}.md`)
				.then((response) => {
					if (!response.ok) {
						return null;
					}
					return response.text();
				})
				.then((text) => {
					if (!text || isHtmlDocument(text)) {
						return;
					}
					const parsed = parseFrontMatter(text);
					const block = document.getElementById('project-content-block');
					const content = document.getElementById('project-content');
					const bodyText = parsed.body || text;
					content.innerHTML = renderMarkdown(bodyText);
					block.classList.remove('hidden');
				});
		})
		.catch((error) => {
			console.error(error);
			setError('Unable to load project data.');
		});
}

function parseFrontMatter(text) {
	const normalized = String(text || '').replace(/\r\n/g, '\n');
	const lines = normalized.split('\n');
	let bodyStart = 0;

	if (lines[0] && lines[0].trim() === '---') {
		for (let i = 1; i < lines.length; i += 1) {
			if (lines[i].trim() === '---') {
				bodyStart = i + 1;
				break;
			}
		}
	}

	return {
		body: lines.slice(bodyStart).join('\n').replace(/^\n+/, '')
	};
}

function isHtmlDocument(text) {
	const sample = String(text || '').trim().slice(0, 200).toLowerCase();
	return sample.startsWith('<!doctype html') || sample.startsWith('<html');
}

function escapeHtml(value) {
	return String(value || '')
		.replace(/&/g, '&amp;')
		.replace(/</g, '&lt;')
		.replace(/>/g, '&gt;')
		.replace(/"/g, '&quot;')
		.replace(/'/g, '&#39;');
}

function renderInlineMarkdown(text) {
	let escaped = escapeHtml(text);
	escaped = escaped.replace(/`([^`]+)`/g, '<code>$1</code>');
	escaped = escaped.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
	escaped = escaped.replace(/\*([^*]+)\*/g, '<em>$1</em>');
	escaped = escaped.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');
	return escaped;
}

function renderMarkdown(text) {
	const lines = String(text || '').replace(/\r\n/g, '\n').split('\n');
	let html = '';
	let inList = false;

	function closeList() {
		if (inList) {
			html += '</ul>';
			inList = false;
		}
	}

	for (let i = 0; i < lines.length; i += 1) {
		const line = lines[i];
		if (!line.trim()) {
			closeList();
			html += '\n';
			continue;
		}

		const headingMatch = line.match(/^(#{1,6})\s+(.*)$/);
		if (headingMatch) {
			closeList();
			const level = headingMatch[1].length;
			html += `<h${level}>${renderInlineMarkdown(headingMatch[2])}</h${level}>`;
			continue;
		}

		const listMatch = line.match(/^\s*[-*]\s+(.*)$/);
		if (listMatch) {
			if (!inList) {
				html += '<ul>';
				inList = true;
			}
			html += `<li>${renderInlineMarkdown(listMatch[1])}</li>`;
			continue;
		}

		closeList();
		html += `<p>${renderInlineMarkdown(line)}</p>`;
	}

	closeList();
	return html;
}
		</script>
	</body>
</html>
